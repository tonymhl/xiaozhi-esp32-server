# 温度负载率工具函数 - 使用说明

## 🎯 功能简介

`get_temperature_load_rate` 是一个集成了外部API的智能工具函数，用于：
1. 收集用户输入的温度和负载率参数
2. 通过递进式两轮确认确保参数正确
3. 启动AI节能优化流程

## ⚙️ 快速配置（3步）

### 步骤1：配置API地址

编辑 `main/xiaozhi-server/data/.config.yaml`（如果不存在则创建）：

```yaml
plugins:
  get_temperature_load_rate:
    api_base_url: "http://10.100.193.243:9000"  # 替换为你的实际API地址
```

> 💡 如果不配置，将使用默认地址：`http://10.100.193.243:9000`

### 步骤2：安装依赖

```bash
cd main/xiaozhi-server
pip install -r requirements.txt
```

> 📦 `requests` 库已包含在 `requirements.txt` 中

### 步骤3：启动服务

```bash
python app.py
```

## 🗣️ 如何使用

### 推荐使用方式（快速响应）

直接说出预设参数，获得毫秒级响应：

```
"设置温度22.5度，负载率90千瓦"
或
"设置温度28度，负载率95.6千瓦"
```

### 完整对话流程

```
👤 用户："设置温度22.5度，负载率90千瓦"

🤖 小智："您要设置温度22.5℃，负载率90kw，请确认是否正确？"

👤 用户："确认"

🤖 小智："好的，参数已确认。是否使用AI推荐模式进行节能优化？"

👤 用户："好的"

🤖 小智："✅ 已确认使用AI推荐模式，开始AI节能优化
        温度: 22.5℃
        负载率: 90kw
        系统已启动AI节能优化流程"
```

### 其他使用方式

**分步输入**：
```
👤："设置温度"
🤖："好的，请问您想设置的温度是多少度？"
👤："22.5度"
🤖："温度已设置为22.5℃，请问负载率是多少千瓦？"
👤："90千瓦"
🤖："您要设置温度22.5℃，负载率90kw，请确认是否正确？"
...
```

**取消操作**：
```
👤："设置温度22度，负载率90千瓦"
🤖："您要设置温度22℃，负载率90kw，请确认是否正确？"
👤："取消"
🤖："好的，已取消温度负载率设置"
```

## 📊 预设参数（推荐）

为了获得最佳体验，推荐使用以下预设参数：

| 温度 | 负载率 | 响应速度 |
|------|--------|----------|
| 22.5℃ | 90kw | ⚡ 毫秒级 |
| 28℃ | 95.6kw | ⚡ 毫秒级 |
| 其他 | 其他 | ⏳ 10-30秒 |

## ⚠️ 注意事项

1. **负载率单位**：负载率的单位是**千瓦(kw)**，不是百分比
2. **参数范围**：
   - 温度：-10℃ ~ 50℃
   - 负载率：0kw ~ 200kw
3. **任务冲突**：如果提示"优化任务正在进行中"，请等待几分钟后重试
4. **网络连接**：确保能访问配置的API地址

## 🐛 常见问题

### Q: 为什么响应很慢？
**A**: 非预设参数需要10-30秒处理。建议使用预设参数 (22.5, 90) 或 (28, 95.6)

### Q: 提示"优化任务正在进行中"？
**A**: 后台正在执行任务，请等待几分钟后重试

### Q: 如何修改API地址？
**A**: 编辑 `data/.config.yaml` 中的 `plugins.get_temperature_load_rate.api_base_url`

### Q: 负载率的单位是什么？
**A**: 千瓦(kw)，不是百分比。例如："90千瓦"或"90kw"

## 📚 详细文档

- **详细开发文档**：`docs/get_temperature_load_rate_api_integration.md`
- **快速开始指南**：`docs/get_temperature_load_rate_quickstart.md`
- **完成总结**：`温度负载率工具函数API集成完成总结.md`

## 🔍 测试API

在启动服务前，可以手动测试API是否可用：

```bash
# 测试接口1
curl --location 'http://10.100.193.243:9000/api/asr' \
--header 'Content-Type: application/json' \
--data '{"temperature": "22.5", "load_rate": "90"}'

# 测试接口2
curl --location 'http://10.100.193.243:9000/api/confirm' \
--header 'Content-Type: application/json' \
--data '{"status": 1}'
```

## ✅ 验证安装

运行验证脚本（需要先安装依赖）：

```bash
cd main/xiaozhi-server
python verify_api_integration.py
```

## 🎉 开始使用

一切就绪！现在你可以通过语音或文本与小智交互，设置温度和负载率参数，启动AI节能优化了！

---

**祝使用愉快！** 🚀

