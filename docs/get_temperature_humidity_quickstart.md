# get_temperature_humidity 快速开始指南

## 🚀 5分钟上手指南

本指南将帮助您快速理解和使用 `get_temperature_humidity` 工具函数。

## 📋 前置条件

- xiaozhi-esp32-server 项目已部署
- 系统正常运行
- 已配置 LLM（支持 function calling）

## ✅ 功能已自动启用

由于系统采用自动加载机制，`get_temperature_humidity` 函数已经自动注册并可用，**无需额外配置**！

函数位置：
```
main/xiaozhi-server/plugins_func/functions/get_temperature_humidity.py
```

## 🎯 快速测试

### 方法1：直接对话测试（推荐）

启动服务后，通过终端设备或Web界面进行对话测试：

```
1️⃣ 用户: "我要设置温湿度"
   系统: 会询问您的温度和湿度值

2️⃣ 用户: "温度22度"
   系统: 记录温度，询问湿度

3️⃣ 用户: "湿度60%"
   系统: 显示汇总，请求确认

4️⃣ 用户: "确认"
   系统: 返回JSON结果
```

### 方法2：一句话测试

```
用户: "设置温度22度湿度60%"
系统: 显示参数并请求确认
用户: "确认"
系统: 返回结果
```

### 方法3：运行单元测试

```bash
cd main/xiaozhi-server/plugins_func/functions/
python test_get_temperature_humidity.py
```

## 📊 预期返回结果

当用户确认参数后，函数返回JSON格式的结果：

```json
{
    "temperature": "22℃",
    "humidity": "60%",
    "confirm": true
}
```

## 🔧 验证函数已加载

### 查看日志

启动服务时，查看日志中是否有类似信息：

```
函数 'get_temperature_humidity' 已加载，可以注册使用
```

### 检查函数注册表

在Python控制台中执行：

```python
from plugins_func.register import all_function_registry

# 查看所有已注册的函数
print(all_function_registry.keys())

# 检查特定函数
if 'get_temperature_humidity' in all_function_registry:
    print("✅ get_temperature_humidity 已注册")
    func_item = all_function_registry['get_temperature_humidity']
    print(f"函数类型: {func_item.type}")
    print(f"函数描述: {func_item.description}")
```

## 🎨 实际应用场景

### 场景1：集成到空调控制

```python
# 在您的空调控制函数中
def control_air_conditioner(conn):
    """空调控制函数"""
    # 用户说"把空调设置到舒适模式"
    # LLM会调用 get_temperature_humidity 收集参数
    # 获取到确认的参数后，执行空调控制
    pass
```

### 场景2：环境监控报警设置

```python
def set_environment_alert(conn):
    """设置环境报警阈值"""
    # 用户说"设置温湿度报警"
    # 系统引导用户输入温湿度阈值
    # 确认后保存到数据库
    pass
```

## 🎪 对话演示

### 完整对话流程

```
┌─────────────────────────────────────────┐
│ 用户：帮我设置一下温湿度                    │
└─────────────────────────────────────────┘
                   ↓
┌─────────────────────────────────────────┐
│ 系统：好的，请告诉我您想设置的温度和湿度值     │
└─────────────────────────────────────────┘
                   ↓
┌─────────────────────────────────────────┐
│ 用户：温度25度                             │
└─────────────────────────────────────────┘
                   ↓
┌─────────────────────────────────────────┐
│ 系统：温度已设置为25℃，请告诉我湿度值        │
└─────────────────────────────────────────┘
                   ↓
┌─────────────────────────────────────────┐
│ 用户：65%                                 │
└─────────────────────────────────────────┘
                   ↓
┌─────────────────────────────────────────┐
│ 系统：温度为25℃，湿度为65%，请确认是否正确？ │
└─────────────────────────────────────────┘
                   ↓
┌─────────────────────────────────────────┐
│ 用户：没错                                 │
└─────────────────────────────────────────┘
                   ↓
┌─────────────────────────────────────────┐
│ 系统：✅ 返回JSON结果                      │
│ {"temperature": "25℃", "humidity": "65%",│
│  "confirm": true}                       │
└─────────────────────────────────────────┘
```

## 🐛 问题排查

### 问题1：函数未被调用

**可能原因**：
- LLM未识别用户意图
- 函数描述不够清晰

**解决方案**：
- 使用更明确的触发词，如"设置温湿度"
- 检查 LLM 是否支持 function calling
- 查看日志确认函数是否已注册

### 问题2：参数解析失败

**可能原因**：
- 输入格式不规范

**解决方案**：
- 使用标准格式：22度、60%
- 查看日志中的解析信息
- 参考文档中的支持格式

### 问题3：状态混乱

**可能原因**：
- 上次会话未正常结束

**解决方案**：
- 说"取消"清除当前状态
- 重新开始新的设置流程

## 📚 更多资源

- [详细使用说明](./get_temperature_humidity_usage.md)
- [技术开发文档](./get_temperature_humidity_development.md)
- [项目主文档](../README.md)

## 💡 使用技巧

### ✨ 技巧1：快速设置

一次性提供所有参数，可以大大减少对话轮次：

```
用户: "温度22度湿度60%"  ← 推荐
而不是分步：
用户: "设置温度"
系统: "请告诉我温度值"
用户: "22度"
...
```

### ✨ 技巧2：随时修改

在确认前，您可以随时修改任何参数：

```
系统: "温度22℃，湿度60%，请确认"
用户: "温度改成25度"  ← 直接说修改项
系统: "已修改，温度25℃，湿度60%，请确认"
```

### ✨ 技巧3：清晰表达

使用清晰的单位和数值：

```
✅ 推荐：
- "温度22度"
- "湿度60%"
- "25℃"

❌ 避免：
- "温度二十几"（模糊）
- "很高的温度"（主观）
```

## 🎉 开始使用

现在您已经了解了基础使用方法，可以开始在您的项目中使用这个功能了！

试着说：**"帮我设置温度22度，湿度60%"**

祝使用愉快！ 🚀

