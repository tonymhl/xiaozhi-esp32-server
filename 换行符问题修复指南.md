# Windows/Linux æ¢è¡Œç¬¦é—®é¢˜ä¿®å¤æŒ‡å—

## ğŸ” é—®é¢˜æè¿°

åœ¨Windowsä¸Šæ‰“åŒ…çš„éƒ¨ç½²åŒ…ï¼Œåœ¨Linuxä¸Šéƒ¨ç½²æ—¶å‡ºç°æ ¡éªŒå’ŒéªŒè¯å¤±è´¥ï¼š

```bash
md5sum: 'web.tar'$'\r': No such file or directory
: FAILED open or read
```

**åŸå› **: Windowsä½¿ç”¨CRLFï¼ˆ`\r\n`ï¼‰æ¢è¡Œç¬¦ï¼ŒLinuxä½¿ç”¨LFï¼ˆ`\n`ï¼‰æ¢è¡Œç¬¦ã€‚

---

## âœ… å·²ä¿®å¤

æˆ‘å·²ç»ä¿®å¤äº†ä¸¤ä¸ªåœ°æ–¹ï¼š

### 1. PowerShellæ‰“åŒ…è„šæœ¬ï¼ˆ`scripts/offline-package.ps1`ï¼‰
- âœ… ç°åœ¨ç”ŸæˆUnixæ ¼å¼ï¼ˆLFï¼‰çš„`checksums.md5`æ–‡ä»¶
- âœ… ä½¿ç”¨ `[System.IO.File]::WriteAllText` ç²¾ç¡®æ§åˆ¶æ¢è¡Œç¬¦

### 2. éƒ¨ç½²è„šæœ¬ï¼ˆ`scripts/offline-deploy.sh`ï¼‰
- âœ… è‡ªåŠ¨æ£€æµ‹å¹¶è½¬æ¢CRLFåˆ°LF
- âœ… å¦‚æœMD5æ ¡éªŒå¤±è´¥ï¼Œè‡ªåŠ¨ä½¿ç”¨tarå‘½ä»¤éªŒè¯æ–‡ä»¶å®Œæ•´æ€§
- âœ… æ›´å¥å£®çš„é”™è¯¯å¤„ç†

---

## ğŸš€ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆAï¼šé‡æ–°æ‰“åŒ…ï¼ˆæ¨èï¼‰

ä½¿ç”¨ä¿®å¤åçš„è„šæœ¬é‡æ–°æ‰“åŒ…ï¼š

```powershell
# 1. æ¸…ç†æ—§çš„æ‰“åŒ…æ–‡ä»¶
.\scripts\clean-and-rebuild.ps1

# 2. é‡æ–°æ‰“åŒ…
.\scripts\offline-package.ps1
```

æ–°ç”Ÿæˆçš„éƒ¨ç½²åŒ…å°†ä½¿ç”¨æ­£ç¡®çš„Unixæ¢è¡Œç¬¦ã€‚

---

### æ–¹æ¡ˆBï¼šä¿®å¤ç°æœ‰éƒ¨ç½²åŒ…ï¼ˆåº”æ€¥æ–¹æ¡ˆï¼‰

å¦‚æœå·²ç»å°†éƒ¨ç½²åŒ…ä¼ è¾“åˆ°äº†CentOSæœåŠ¡å™¨ï¼Œå¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šæ‰‹åŠ¨ä¿®å¤ï¼š

```bash
# 1. è§£å‹éƒ¨ç½²åŒ…
cd /root
tar -xzf xiaozhi-offline-deployment-*.tar.gz
cd xiaozhi-offline-deployment-*/images

# 2. ä¿®å¤checksums.md5æ–‡ä»¶
# æ–¹æ³•1: ä½¿ç”¨dos2unixï¼ˆå¦‚æœå·²å®‰è£…ï¼‰
dos2unix checksums.md5

# æ–¹æ³•2: ä½¿ç”¨sedï¼ˆé€šç”¨æ–¹æ³•ï¼‰
sed -i 's/\r$//' checksums.md5

# 3. éªŒè¯ä¿®å¤
file checksums.md5
# åº”è¯¥æ˜¾ç¤º: checksums.md5: ASCII text

# 4. é‡æ–°éªŒè¯
md5sum -c checksums.md5

# 5. å¦‚æœéªŒè¯é€šè¿‡ï¼Œç»§ç»­éƒ¨ç½²
cd ..
./offline-deploy.sh
```

---

### æ–¹æ¡ˆCï¼šä½¿ç”¨æ›´æ–°çš„éƒ¨ç½²è„šæœ¬

æ›´æ–°åçš„ `offline-deploy.sh` è„šæœ¬å·²ç»å†…ç½®äº†è‡ªåŠ¨ä¿®å¤åŠŸèƒ½ï¼Œç›´æ¥è¿è¡Œå³å¯ï¼š

```bash
cd /root/xiaozhi-offline-deployment-*/
chmod +x offline-deploy.sh
./offline-deploy.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
1. æ£€æµ‹Windowsæ¢è¡Œç¬¦
2. è‡ªåŠ¨è½¬æ¢ä¸ºUnixæ ¼å¼
3. å¦‚æœMD5å¤±è´¥ï¼Œä½¿ç”¨tarå‘½ä»¤éªŒè¯
4. åªæœ‰åœ¨æ–‡ä»¶çœŸæ­£æŸåæ—¶æ‰æŠ¥é”™

---

## ğŸ”§ éªŒè¯ä¿®å¤æ•ˆæœ

### åœ¨Windowsä¸Šï¼ˆæ‰“åŒ…åï¼‰

```powershell
# æ£€æŸ¥ç”Ÿæˆçš„checksums.md5æ–‡ä»¶
Get-Content xiaozhi-offline-deployment-*/images/checksums.md5 -Raw | Format-Hex
# åº”è¯¥çœ‹åˆ° 0Aï¼ˆLFï¼‰ï¼Œè€Œä¸æ˜¯ 0D 0Aï¼ˆCRLFï¼‰
```

### åœ¨Linuxä¸Šï¼ˆéƒ¨ç½²å‰ï¼‰

```bash
# æ£€æŸ¥æ–‡ä»¶æ ¼å¼
file images/checksums.md5
# åº”è¯¥æ˜¾ç¤º: ASCII textï¼ˆä¸åº”è¯¥æœ‰"CRLF"å­—æ ·ï¼‰

# æŸ¥çœ‹åå…­è¿›åˆ¶
od -c images/checksums.md5 | head
# åº”è¯¥åªçœ‹åˆ°\nï¼Œä¸åº”è¯¥æœ‰\r
```

---

## ğŸ“‹ é¢„é˜²æªæ–½

### 1. ä½¿ç”¨ä¿®å¤åçš„è„šæœ¬

å§‹ç»ˆä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„æ‰“åŒ…è„šæœ¬ï¼š
- `scripts/offline-package.ps1`ï¼ˆå·²ä¿®å¤ï¼‰
- `scripts/offline-package.sh`ï¼ˆLinuxç‰ˆæœ¬ï¼‰

### 2. Gité…ç½®

å¦‚æœä½¿ç”¨Gitï¼Œç¡®ä¿æ­£ç¡®é…ç½®ï¼š

```bash
# æŸ¥çœ‹å½“å‰é…ç½®
git config core.autocrlf

# Windowså¼€å‘ç¯å¢ƒæ¨èè®¾ç½®
git config --global core.autocrlf true

# Linuxç¯å¢ƒ
git config --global core.autocrlf input
```

### 3. æ–‡ä»¶ä¼ è¾“

ä½¿ç”¨äºŒè¿›åˆ¶æ¨¡å¼ä¼ è¾“ï¼š
- SCP: é»˜è®¤äºŒè¿›åˆ¶æ¨¡å¼ï¼ˆæ— é—®é¢˜ï¼‰
- FTP: ä½¿ç”¨binaryæ¨¡å¼ï¼Œä¸è¦ç”¨ASCIIæ¨¡å¼
- å‹ç¼©åŒ…: tar.gzæ ¼å¼ä¼šä¿æŒåŸå§‹æ ¼å¼

---

## â“ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆåªæœ‰checksums.md5æœ‰é—®é¢˜ï¼Ÿ

A: å› ä¸ºï¼š
- `.tar` æ–‡ä»¶æ˜¯äºŒè¿›åˆ¶ï¼Œä¸å—æ¢è¡Œç¬¦å½±å“
- `checksums.md5` æ˜¯æ–‡æœ¬æ–‡ä»¶ï¼Œä¼šå—å½±å“
- å…¶ä»–è„šæœ¬æ–‡ä»¶ï¼ˆ`.sh`ï¼‰åœ¨Linuxä¸Šæ‰§è¡Œå‰ä¼šè¢«bashè‡ªåŠ¨å¤„ç†

### Q2: é‡æ–°æ‰“åŒ…ä¼šå¾ˆæ…¢å—ï¼Ÿ

A: ä¸ä¼šç‰¹åˆ«æ…¢ï¼š
- å¦‚æœé•œåƒå·²ç»å­˜åœ¨ï¼Œç¼–è¯‘æ­¥éª¤ä¼šå¾ˆå¿«ï¼ˆä½¿ç”¨ç¼“å­˜ï¼‰
- åªéœ€è¦é‡æ–°å¯¼å‡ºé•œåƒå’Œæ‰“åŒ…
- å¤§çº¦éœ€è¦5-15åˆ†é’Ÿ

### Q3: èƒ½å¦åªä¿®å¤checksums.md5è€Œä¸é‡æ–°æ‰“åŒ…ï¼Ÿ

A: å¯ä»¥ï¼Œä½†ä¸æ¨èï¼š
```bash
# åœ¨å·²æœ‰çš„å‹ç¼©åŒ…ä¸­ä¿®å¤
tar -xzf xiaozhi-offline-deployment-*.tar.gz
cd xiaozhi-offline-deployment-*/images
sed -i 's/\r$//' checksums.md5
cd ../..
tar -czf xiaozhi-offline-deployment-fixed.tar.gz xiaozhi-offline-deployment-*/
```

### Q4: æ›´æ–°çš„éƒ¨ç½²è„šæœ¬èƒ½å¤„ç†å…¶ä»–é—®é¢˜å—ï¼Ÿ

A: æ˜¯çš„ï¼Œæ–°è„šæœ¬å¢åŠ äº†ï¼š
- âœ… è‡ªåŠ¨æ¢è¡Œç¬¦è½¬æ¢
- âœ… taræ–‡ä»¶å®Œæ•´æ€§å¤‡ç”¨éªŒè¯
- âœ… æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- âœ… æ›´å¥½çš„å®¹é”™èƒ½åŠ›

---

## ğŸ¯ æ¨èæ“ä½œæµç¨‹

### å¯¹äºæ–°æ‰“åŒ…ï¼š

1. ä½¿ç”¨æ›´æ–°çš„ `scripts/offline-package.ps1`
2. æ‰“åŒ…å®ŒæˆåéªŒè¯ï¼ˆå¯é€‰ï¼‰
3. æ­£å¸¸ä¼ è¾“å’Œéƒ¨ç½²

### å¯¹äºç°æœ‰éƒ¨ç½²åŒ…ï¼š

1. ä½¿ç”¨æ›´æ–°çš„ `scripts/offline-deploy.sh`
2. è„šæœ¬ä¼šè‡ªåŠ¨å¤„ç†æ¢è¡Œç¬¦é—®é¢˜
3. å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œä½¿ç”¨æ–¹æ¡ˆBæ‰‹åŠ¨ä¿®å¤

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°å…¶ä»–é—®é¢˜ï¼š

1. æ£€æŸ¥ `docker logs` ç¡®è®¤ä¸æ˜¯é•œåƒæœ¬èº«çš„é—®é¢˜
2. ç¡®è®¤ç½‘ç»œä¼ è¾“æ²¡æœ‰æŸåæ–‡ä»¶ï¼ˆMD5æ ¡éªŒï¼‰
3. å‚è€ƒ `docs/offline-deployment-troubleshooting.md`

---

**ç°åœ¨æ‚¨å¯ä»¥æ”¾å¿ƒä½¿ç”¨ä¿®å¤åçš„è„šæœ¬è¿›è¡Œæ‰“åŒ…å’Œéƒ¨ç½²äº†ï¼** âœ…

