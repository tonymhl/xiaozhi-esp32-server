# 小智ESP32服务器 - 离线部署方案文件清单

本文档列出了为离线部署创建的所有文件。

---

## 📋 创建的文件列表

### 📖 文档文件 (docs/)

1. **docs/offline-deployment-README.md** - 总览文档
   - 文档导航和索引
   - 使用场景说明
   - 常用命令速查
   - 系统要求和安全建议

2. **docs/offline-deployment-guide.md** - 完整部署指南 ⭐
   - 详细的部署步骤
   - 配置说明
   - 验证测试方法
   - 服务管理命令
   - 基础故障排查

3. **docs/offline-deployment-quickstart.md** - 快速部署指南 ⭐
   - 5分钟快速部署
   - 精简的步骤说明
   - 常见问题快速解决

4. **docs/offline-deployment-checklist.md** - 部署检查清单
   - 完整的检查项目
   - 六个阶段的详细清单
   - 可打印使用

5. **docs/offline-deployment-troubleshooting.md** - 故障排查手册
   - 常见问题详细解决方案
   - 系统诊断方法
   - 性能优化建议
   - 数据恢复方案

### 🛠️ 脚本文件 (scripts/)

6. **scripts/offline-package.sh** - Linux/Mac打包脚本
   - 自动编译镜像
   - 导出镜像文件
   - 复制配置文件
   - 生成压缩包

7. **scripts/offline-package.ps1** - Windows打包脚本
   - Windows PowerShell版本
   - 功能与Linux版相同

8. **scripts/offline-deploy.sh** - 离线部署脚本
   - 自动加载镜像
   - 配置系统环境
   - 启动所有服务
   - 健康检查

9. **scripts/install-docker-centos.sh** - Docker安装脚本
   - 支持CentOS 7/8/Stream
   - 自动配置镜像源
   - 安装Docker和Docker Compose

10. **scripts/backup.sh** - 数据备份脚本
    - 备份配置文件
    - 备份数据库
    - 备份上传文件
    - 自动清理旧备份

11. **scripts/README.md** - 脚本使用说明
    - 所有脚本的详细说明
    - 使用方法和示例
    - 故障排查技巧

### ⚙️ 配置文件 (scripts/)

12. **scripts/docker-compose-offline.template.yml** - Docker Compose模板
    - 离线部署配置
    - 包含资源限制
    - 日志轮转配置
    - 优化的数据库参数

---

## 📂 文件用途说明

### 打包阶段使用（在线环境）

```
scripts/offline-package.sh       # Linux/Mac: 一键打包所有内容
scripts/offline-package.ps1      # Windows: 一键打包所有内容
```

### 部署阶段使用（离线环境）

```
scripts/install-docker-centos.sh # 安装Docker（如需要）
scripts/offline-deploy.sh        # 一键部署所有服务
```

### 运维阶段使用

```
scripts/backup.sh                # 定期备份数据
```

### 文档参考

```
docs/offline-deployment-README.md          # 先看这个，了解整体
docs/offline-deployment-quickstart.md      # 快速部署参考
docs/offline-deployment-guide.md           # 详细步骤参考
docs/offline-deployment-checklist.md       # 边部署边对照
docs/offline-deployment-troubleshooting.md # 遇到问题时查阅
scripts/README.md                          # 脚本使用参考
```

---

## 🎯 推荐的阅读顺序

### 首次部署

1. **docs/offline-deployment-README.md** - 了解整体方案
2. **docs/offline-deployment-quickstart.md** - 快速开始
3. **docs/offline-deployment-checklist.md** - 对照执行
4. **docs/offline-deployment-troubleshooting.md** - 遇到问题时查看

### 详细学习

1. **docs/offline-deployment-guide.md** - 完整详细指南
2. **scripts/README.md** - 脚本工具说明
3. **docs/offline-deployment-troubleshooting.md** - 深入排查方法

---

## 🚀 快速开始

### 第一步：打包（在线环境）

**Windows:**
```powershell
cd xiaozhi-esp32-server
.\scripts\offline-package.ps1
```

**Linux/Mac:**
```bash
cd xiaozhi-esp32-server
chmod +x scripts/offline-package.sh
./scripts/offline-package.sh
```

### 第二步：传输

将生成的 `xiaozhi-offline-deployment-*.tar.gz` 传输到目标服务器。

### 第三步：部署（离线环境）

```bash
# 解压
tar -xzf xiaozhi-offline-deployment-*.tar.gz
cd xiaozhi-offline-deployment-*/

# 安装Docker（如需要）
chmod +x install-docker-centos.sh
sudo ./install-docker-centos.sh

# 部署
chmod +x offline-deploy.sh
sudo ./offline-deploy.sh
```

### 第四步：验证

访问 `http://服务器IP:8002` 验证部署成功。

---

## 📊 文件统计

| 类型 | 数量 | 说明 |
|------|------|------|
| 文档文件 | 5个 | Markdown格式，详细说明 |
| 脚本文件 | 5个 | Bash和PowerShell脚本 |
| 配置模板 | 1个 | Docker Compose配置 |
| 说明文档 | 1个 | 脚本使用说明 |
| **总计** | **12个** | 完整的离线部署方案 |

---

## ✨ 方案特点

### 🎯 完整性

- ✅ 从打包到部署的完整流程
- ✅ 详细的文档说明
- ✅ 自动化脚本工具
- ✅ 故障排查指南
- ✅ 运维维护方案

### 🚀 易用性

- ✅ 一键打包和部署
- ✅ 清晰的步骤说明
- ✅ 快速开始指南
- ✅ 常用命令速查
- ✅ 检查清单辅助

### 🛡️ 可靠性

- ✅ 文件完整性校验
- ✅ 健康检查机制
- ✅ 自动备份方案
- ✅ 详细的日志记录
- ✅ 错误处理机制

### 📚 可维护性

- ✅ 模块化的脚本设计
- ✅ 详细的注释说明
- ✅ 配置文件集中管理
- ✅ 版本控制支持
- ✅ 运维工具完善

---

## 🔧 自定义和扩展

### 添加新的工具函数

您的新工具函数（如 `get_temperature_load_rate.py`）会被自动包含在打包过程中。

确保：
1. 文件位于 `main/xiaozhi-server/plugins_func/functions/` 目录
2. 所需的Python依赖已添加到 `requirements.txt`
3. 在 `config.yaml` 中正确配置（如需要）

### 修改打包内容

编辑 `scripts/offline-package.sh` 或 `scripts/offline-package.ps1`，在 `copy_configs()` 函数中添加您需要的额外文件。

### 修改部署配置

编辑 `scripts/docker-compose-offline.template.yml` 来调整：
- 端口映射
- 资源限制
- 环境变量
- 数据卷挂载

---

## 📞 技术支持

### 文档支持

- 本地文档：查看 `docs/` 目录下的文档
- 在线文档：https://github.com/xinnan-tech/xiaozhi-esp32-server/tree/main/docs

### 社区支持

- 问题反馈：https://github.com/xinnan-tech/xiaozhi-esp32-server/issues
- 项目主页：https://github.com/xinnan-tech/xiaozhi-esp32-server

---

## 📝 版本信息

- **方案版本**: 1.0
- **创建日期**: 2024
- **适用于**: 小智ESP32服务器项目
- **支持系统**: CentOS 7/8/Stream, RHEL, Rocky Linux, AlmaLinux

---

## ✅ 验证清单

确认以下文件都已创建：

- [ ] docs/offline-deployment-README.md
- [ ] docs/offline-deployment-guide.md
- [ ] docs/offline-deployment-quickstart.md
- [ ] docs/offline-deployment-checklist.md
- [ ] docs/offline-deployment-troubleshooting.md
- [ ] scripts/offline-package.sh
- [ ] scripts/offline-package.ps1
- [ ] scripts/offline-deploy.sh
- [ ] scripts/install-docker-centos.sh
- [ ] scripts/backup.sh
- [ ] scripts/README.md
- [ ] scripts/docker-compose-offline.template.yml

所有文件创建完成后，您就可以开始使用这套完整的离线部署方案了！

---

**祝您使用顺利！** 🎉

