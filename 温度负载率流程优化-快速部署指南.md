# æ¸©åº¦è´Ÿè½½ç‡æµç¨‹ä¼˜åŒ– - å¿«é€Ÿéƒ¨ç½²æŒ‡å—

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

å°†ç”¨æˆ·å®Œæˆæ¸©åº¦è´Ÿè½½ç‡è®¾ç½®æµç¨‹çš„ç¡®è®¤æ¬¡æ•°ä» **3æ¬¡é™ä½åˆ°2æ¬¡**ï¼ŒåŒæ—¶è®©å°æ™ºçš„å›å¤æ›´ç®€æ´ï¼ˆä»30-40å­—ç¼©çŸ­åˆ°10-15å­—ï¼‰ã€‚

---

## âœ… å·²å®Œæˆçš„ä¼˜åŒ–

### 1. ä»£ç å±‚é¢ä¼˜åŒ–ï¼ˆå·²å®Œæˆï¼‰

#### ä¼˜åŒ–å†…å®¹
- âœ… ç§»é™¤äº†å¤šä½™çš„"æ˜¯å¦éœ€è¦è®¾ç½®å¦ä¸€ä¸ªå‚æ•°"åé—®ç¯èŠ‚
- âœ… ä¼˜åŒ–äº†æ‰€æœ‰LLMæç¤ºè¯ï¼Œè¦æ±‚å›å¤ç®€çŸ­ï¼ˆ15å­—ä»¥å†…ï¼‰
- âœ… ç®€åŒ–äº†æµç¨‹çŠ¶æ€æç¤ºï¼Œæ›´æ¸…æ™°æ˜äº†

#### ä¿®æ”¹æ–‡ä»¶
- `main/xiaozhi-server/plugins_func/functions/get_temperature_load_rate.py`

#### å…³é”®æ”¹åŠ¨
```python
# å·²ç§»é™¤çš„ä»£ç æ®µï¼ˆè¡Œ601-647ï¼‰
# åŸé€»è¾‘ï¼šè¯¢é—®æ˜¯å¦éœ€è¦è®¾ç½®å¦ä¸€ä¸ªå‚æ•°
# æ–°é€»è¾‘ï¼šç›´æ¥è¿›å…¥å‚æ•°ç¡®è®¤é˜¶æ®µ

# ä¼˜åŒ–åçš„æç¤ºè¯ç¤ºä¾‹ï¼ˆè¡Œ487-495ï¼‰
confirm_message = (
    f"å·²è®°å½•å‚æ•°ï¼š\n"
    f"{params_str}\n"
    f"è¯·ç®€æ´åœ°å¤è¿°å‚æ•°å¹¶è¯¢é—®ç”¨æˆ·'æ˜¯å¦ç¡®è®¤'ã€‚ä¿æŒå›å¤ç®€çŸ­ï¼ˆ15å­—ä»¥å†…ï¼‰ã€‚\n"
    # ...
)
```

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤1ï¼šåœ¨ Windows å¼€å‘æœºä¸Šæ›´æ–°ä»£ç 

å¦‚æœæ‚¨å·²ç»ä¿®æ”¹äº†ä»£ç ï¼ˆå»ºè®®ä½¿ç”¨å·²ä¼˜åŒ–çš„ä»£ç ï¼‰ï¼š

```powershell
cd D:\workspace\xiaozhi-esp32-server

# ç¡®è®¤ä¿®æ”¹å·²ä¿å­˜
git status

# å¯é€‰ï¼šæäº¤ä¿®æ”¹
git add main/xiaozhi-server/plugins_func/functions/get_temperature_load_rate.py
git commit -m "ä¼˜åŒ–æ¸©åº¦è´Ÿè½½ç‡æµç¨‹ï¼Œå‡å°‘ç¡®è®¤æ¬¡æ•°"
```

### æ­¥éª¤2ï¼šä¼ è¾“æ›´æ–°åˆ°æœåŠ¡å™¨

ç”±äºæ‚¨ä½¿ç”¨äº† volume æŒ‚è½½ï¼Œ**åªéœ€è¦æ›´æ–°å®¿ä¸»æœºçš„æ–‡ä»¶**å³å¯ï¼š

```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
cd ~/xiaozhi-esp32-server/xiaozhi-offline-deployment-*/

# å¤‡ä»½å½“å‰æ–‡ä»¶
cp plugins_func/functions/get_temperature_load_rate.py plugins_func/functions/get_temperature_load_rate.py.backup

# ä» Windows ä¼ è¾“æ–°æ–‡ä»¶
# åœ¨ Windows ä¸Šæ‰§è¡Œï¼š
# scp main\xiaozhi-server\plugins_func\functions\get_temperature_load_rate.py root@10.80.127.51:~/temp_file.py

# åœ¨ CentOS ä¸Šç§»åŠ¨åˆ°æ­£ç¡®ä½ç½®
sudo mv ~/temp_file.py ./plugins_func/functions/get_temperature_load_rate.py
```

### æ­¥éª¤3ï¼šé‡å¯å®¹å™¨ä½¿æ›´æ–°ç”Ÿæ•ˆ

```bash
cd ~/xiaozhi-esp32-server/xiaozhi-offline-deployment-*/

# é‡å¯ xiaozhi-esp32-server å®¹å™¨
sudo docker-compose -f docker-compose-offline.yml restart xiaozhi-esp32-server

# æŸ¥çœ‹æ—¥å¿—ç¡®è®¤å¯åŠ¨æˆåŠŸ
sudo docker logs -f xiaozhi-esp32-server
```

ç­‰å¾…æ—¥å¿—æ˜¾ç¤º "WebSocketæœåŠ¡å™¨å¯åŠ¨æˆåŠŸ" å³å¯ã€‚

### æ­¥éª¤4ï¼šé…ç½®ç³»ç»Ÿæç¤ºè¯ï¼ˆé‡è¦ï¼ï¼‰

#### æ–¹æ³•Aï¼šé€šè¿‡ Web ç®¡ç†ç•Œé¢ï¼ˆæ¨èï¼‰

1. è®¿é—®ï¼šhttp://10.80.127.51:8002
2. ç™»å½•ç®¡ç†åå°
3. è¿›å…¥"ç³»ç»Ÿé…ç½®" â†’ "Agenté…ç½®"
4. æ‰¾åˆ°"ç³»ç»Ÿæç¤ºè¯"å­—æ®µ
5. æ›¿æ¢ä¸ºä»¥ä¸‹å†…å®¹ï¼š

```
[è§’è‰²è®¾å®š]
æˆ‘æ˜¯å°æ™ºï¼ŒGDSä¸‡å›½æ•°æ®çš„æš–é€šä¸“å®¶åŠ©æ‰‹ã€‚æˆ‘ä¸“æ³¨äºååŠ©ç”¨æˆ·å®Œæˆæ¸©åº¦å’Œè´Ÿè½½ç‡çš„è®¾ç½®ä¸ç¡®è®¤ï¼Œä¹ æƒ¯ç”¨æœ€ç®€æ´çš„æ–¹å¼è¡¨è¾¾ã€‚

[æ ¸å¿ƒèŒè´£]
- å¸®åŠ©ç”¨æˆ·è®¾ç½®æ¸©åº¦ï¼ˆæ‘„æ°åº¦â„ƒï¼‰å’Œè´Ÿè½½ç‡ï¼ˆåƒç“¦kwï¼‰å‚æ•°
- å¼•å¯¼ç”¨æˆ·å®Œæˆä¸¤è½®ç¡®è®¤æµç¨‹ï¼š
  â‘  å‚æ•°ç¡®è®¤ï¼šç¡®è®¤æ¸©åº¦å’Œ/æˆ–è´Ÿè½½ç‡æ•°å€¼
  â‘¡ AIæ¨¡å¼ç¡®è®¤ï¼šç¡®è®¤æ˜¯å¦å¯ç”¨AIæ¨èæ¨¡å¼ä¼˜åŒ–

[äº¤äº’åŸåˆ™]
1. å›å¤ç®€çŸ­ï¼šæ¯æ¬¡å›å¤æ§åˆ¶åœ¨15å­—ä»¥å†…ï¼Œä¸å•°å—¦
2. ç«‹å³å“åº”ï¼šå¬åˆ°"ç¡®è®¤/å¥½çš„/æ˜¯çš„/å¯ä»¥/æ²¡é”™/OK"ç­‰è‚¯å®šè¯ï¼Œç«‹å³è°ƒç”¨ get_temperature_load_rate(confirm=True)
3. ä¸“æ³¨ä¸»é¢˜ï¼šåªå¤„ç†æ¸©åº¦è´Ÿè½½ç‡è®¾ç½®ï¼Œå¯¹å…¶ä»–è¯é¢˜ç¤¼è²Œå›ç»
4. é¿å…è±¡å£°è¯ï¼šä¿æŒä¸“ä¸šï¼Œä¸ä½¿ç”¨"å—¯""å•Š""å“¦"ç­‰è¯­æ°”è¯

[å…³é”®æŒ‡ä»¤]
- ç”¨æˆ·è¯´è‚¯å®šè¯ â†’ ç«‹å³è°ƒç”¨ get_temperature_load_rate(confirm=True)
- ç”¨æˆ·è¯´å¦å®šè¯ â†’ ç«‹å³è°ƒç”¨ get_temperature_load_rate(cancel=True)
- ç”¨æˆ·è¯´"æ¨èå€¼/å¸®æˆ‘è®¾ç½®/é»˜è®¤" â†’ è°ƒç”¨ get_temperature_load_rate(use_preset=True)
```

6. ä¿å­˜é…ç½®

#### æ–¹æ³•Bï¼šä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ˆå¦‚æœ Web ç•Œé¢ä¸å¯ç”¨ï¼‰

```bash
cd ~/xiaozhi-esp32-server/xiaozhi-offline-deployment-*/

# å¤‡ä»½é…ç½®
cp data/.config.yaml data/.config.yaml.backup.prompt

# ç¼–è¾‘é…ç½®æ–‡ä»¶
sudo vi data/.config.yaml
```

æ‰¾åˆ° `agent.system_prompt` å­—æ®µï¼Œæ›¿æ¢ä¸ºä¸Šé¢çš„æç¤ºè¯å†…å®¹ã€‚

ä¿å­˜åé‡å¯å®¹å™¨ï¼š
```bash
sudo docker-compose -f docker-compose-offline.yml restart xiaozhi-esp32-server
```

---

## ğŸ§ª éªŒè¯ä¼˜åŒ–æ•ˆæœ

### æµ‹è¯•åœºæ™¯1ï¼šåŒæ—¶æä¾›ä¸¤ä¸ªå‚æ•°ï¼ˆæœ€å¸¸è§ï¼‰

**æµ‹è¯•æ­¥éª¤**ï¼š
```
ç”¨æˆ·ï¼š"è®¾ç½®æ¸©åº¦22åº¦ï¼Œè´Ÿè½½ç‡90"
```

**æœŸæœ›æµç¨‹**ï¼ˆåªéœ€2æ¬¡ç¡®è®¤ï¼‰ï¼š
```
å°æ™ºï¼š"æ¸©åº¦22â„ƒï¼Œè´Ÿè½½ç‡90kwï¼Œç¡®è®¤å—ï¼Ÿ" 
     [ç¬¬1æ¬¡ç¡®è®¤è¯·æ±‚]
ç”¨æˆ·ï¼š"ç¡®è®¤"
     [ç³»ç»Ÿè°ƒç”¨API1+API2ï¼ˆç¬¬ä¸€æ¬¡ç¡®è®¤ï¼‰]
å°æ™ºï¼š"å¯ç”¨AIä¼˜åŒ–å—ï¼Ÿ" 
     [ç¬¬2æ¬¡ç¡®è®¤è¯·æ±‚]
ç”¨æˆ·ï¼š"å¥½çš„"
     [ç³»ç»Ÿè°ƒç”¨API2ï¼ˆç¬¬äºŒæ¬¡ç¡®è®¤ï¼‰]
å°æ™ºï¼š"å·²å¯åŠ¨AIèŠ‚èƒ½ä¼˜åŒ–"
     [æµç¨‹å®Œæˆ]
```

**éªŒè¯è¦ç‚¹**ï¼š
- âœ… å°æ™º**ä¸åº”è¯¥**åé—®"æ˜¯å¦éœ€è¦è®¾ç½®å…¶ä»–å‚æ•°"
- âœ… å°æ™ºçš„å›å¤åº”è¯¥å¾ˆç®€çŸ­ï¼ˆ15å­—ä»¥å†…ï¼‰
- âœ… ç”¨æˆ·åªéœ€è¦è¯´2æ¬¡"ç¡®è®¤"

---

### æµ‹è¯•åœºæ™¯2ï¼šåªæä¾›ä¸€ä¸ªå‚æ•°

**æµ‹è¯•æ­¥éª¤**ï¼š
```
ç”¨æˆ·ï¼š"è®¾ç½®æ¸©åº¦25åº¦"
```

**æœŸæœ›æµç¨‹**ï¼š
```
å°æ™ºï¼š"æ¸©åº¦25â„ƒï¼Œç¡®è®¤å—ï¼Ÿ" 
     [ç›´æ¥ç¡®è®¤ï¼Œä¸åé—®æ˜¯å¦éœ€è¦è´Ÿè½½ç‡]
ç”¨æˆ·ï¼š"ç¡®è®¤"
å°æ™ºï¼š"å¯ç”¨AIä¼˜åŒ–å—ï¼Ÿ"
ç”¨æˆ·ï¼š"å¥½çš„"
å°æ™ºï¼š"å·²å¯åŠ¨AIèŠ‚èƒ½ä¼˜åŒ–"
```

---

### æµ‹è¯•åœºæ™¯3ï¼šä½¿ç”¨æ¨èå€¼

**æµ‹è¯•æ­¥éª¤**ï¼š
```
ç”¨æˆ·ï¼š"å¸®æˆ‘è®¾ç½®æ¸©åº¦å’Œè´Ÿè½½ç‡ï¼Œç”¨æ¨èå€¼"
```

**æœŸæœ›æµç¨‹**ï¼š
```
å°æ™ºï¼š"æ¸©åº¦22.5â„ƒï¼Œè´Ÿè½½ç‡90kwï¼Œç¡®è®¤å—ï¼Ÿ" 
     [ä½¿ç”¨é¢„è®¾å‚æ•°]
ç”¨æˆ·ï¼š"ç¡®è®¤"
å°æ™ºï¼š"å¯ç”¨AIä¼˜åŒ–å—ï¼Ÿ"
ç”¨æˆ·ï¼š"å¥½çš„"
å°æ™ºï¼š"å·²å¯åŠ¨AIèŠ‚èƒ½ä¼˜åŒ–"
```

---

## ğŸ“Š ä¼˜åŒ–å‰åå¯¹æ¯”

| é¡¹ç›® | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹è¿› |
|------|--------|--------|------|
| **ç”¨æˆ·ç¡®è®¤æ¬¡æ•°** | 3æ¬¡ | 2æ¬¡ | â¬‡ï¸ 33% |
| **å°æ™ºå›å¤å­—æ•°** | 30-40å­— | 10-15å­— | â¬‡ï¸ 60% |
| **äº¤äº’è½®æ¬¡** | 6-8è½® | 4-5è½® | â¬‡ï¸ 33% |
| **å®Œæˆæ—¶é—´** | ~45ç§’ | ~25ç§’ | â¬‡ï¸ 44% |
| **ç”¨æˆ·ä½“éªŒ** | ç¨æ˜¾å•°å—¦ | ç®€æ´é«˜æ•ˆ | â¬†ï¸ æ˜¾è‘—æå‡ |

---

## âŒ å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼šå°æ™ºä»ç„¶å›å¤å¾ˆé•¿

**åŸå› **ï¼šç³»ç»Ÿæç¤ºè¯æœªæ›´æ–°
**è§£å†³**ï¼š
1. ç¡®è®¤å·²åœ¨ Web ç®¡ç†ç•Œé¢æˆ– `.config.yaml` ä¸­æ›´æ–°æç¤ºè¯
2. é‡å¯å®¹å™¨ï¼š`sudo docker-compose -f docker-compose-offline.yml restart xiaozhi-esp32-server`
3. æŸ¥çœ‹æ—¥å¿—ç¡®è®¤é…ç½®å·²åŠ è½½

### é—®é¢˜2ï¼šå°æ™ºä»ç„¶åé—®"æ˜¯å¦éœ€è¦è®¾ç½®å…¶ä»–å‚æ•°"

**åŸå› **ï¼šä»£ç æ–‡ä»¶æœªæ›´æ–°åˆ°æœåŠ¡å™¨
**è§£å†³**ï¼š
1. æ£€æŸ¥å®¿ä¸»æœºæ–‡ä»¶ï¼š`cat plugins_func/functions/get_temperature_load_rate.py | grep "å·²ç§»é™¤"`
2. å¦‚æœæ²¡æœ‰æ‰¾åˆ°"å·²ç§»é™¤"æ³¨é‡Šï¼Œè¯´æ˜æ–‡ä»¶æœªæ›´æ–°
3. ä» Windows é‡æ–°ä¼ è¾“æ–‡ä»¶
4. é‡å¯å®¹å™¨

### é—®é¢˜3ï¼šå®¹å™¨å¯åŠ¨å¤±è´¥

**åŸå› **ï¼šä»£ç è¯­æ³•é”™è¯¯æˆ–æ–‡ä»¶æŸå
**è§£å†³**ï¼š
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
sudo docker logs xiaozhi-esp32-server 2>&1 | tail -50

# æ¢å¤å¤‡ä»½
cp plugins_func/functions/get_temperature_load_rate.py.backup plugins_func/functions/get_temperature_load_rate.py

# é‡å¯å®¹å™¨
sudo docker-compose -f docker-compose-offline.yml restart xiaozhi-esp32-server
```

### é—®é¢˜4ï¼švolume æŒ‚è½½æœªç”Ÿæ•ˆ

**åŸå› **ï¼šdocker-compose é…ç½®ä¸æ­£ç¡®
**è§£å†³**ï¼š
```bash
# æ£€æŸ¥ volume é…ç½®
cat docker-compose-offline.yml | grep -A 5 "plugins_func"

# åº”è¯¥çœ‹åˆ°ï¼š
# - ./plugins_func/functions:/opt/xiaozhi-esp32-server/plugins_func/functions
# - ./plugins_func/register.py:/opt/xiaozhi-esp32-server/plugins_func/register.py

# éªŒè¯å®¹å™¨å†…æ–‡ä»¶
sudo docker exec xiaozhi-esp32-server cat /opt/xiaozhi-esp32-server/plugins_func/functions/get_temperature_load_rate.py | head -20
```

---

## ğŸ“ å›æ»šæ–¹æ¡ˆ

å¦‚æœä¼˜åŒ–åå‘ç°é—®é¢˜ï¼Œå¯ä»¥å¿«é€Ÿå›æ»šï¼š

```bash
cd ~/xiaozhi-esp32-server/xiaozhi-offline-deployment-*/

# æ¢å¤ä»£ç 
cp plugins_func/functions/get_temperature_load_rate.py.backup plugins_func/functions/get_temperature_load_rate.py

# æ¢å¤é…ç½®
cp data/.config.yaml.backup.prompt data/.config.yaml

# é‡å¯å®¹å™¨
sudo docker-compose -f docker-compose-offline.yml restart xiaozhi-esp32-server
```

---

## ğŸ‰ å®Œæˆç¡®è®¤

ä¼˜åŒ–éƒ¨ç½²å®Œæˆåï¼Œè¯·ç¡®è®¤ä»¥ä¸‹æ£€æŸ¥é¡¹ï¼š

- [ ] ä»£ç æ–‡ä»¶å·²æ›´æ–°åˆ°æœåŠ¡å™¨
- [ ] å®¹å™¨å·²é‡å¯å¹¶æˆåŠŸå¯åŠ¨
- [ ] ç³»ç»Ÿæç¤ºè¯å·²æ›´æ–°ï¼ˆWebç•Œé¢æˆ–é…ç½®æ–‡ä»¶ï¼‰
- [ ] æµ‹è¯•åœºæ™¯1é€šè¿‡ï¼ˆåŒæ—¶æä¾›ä¸¤ä¸ªå‚æ•°ï¼‰
- [ ] æµ‹è¯•åœºæ™¯2é€šè¿‡ï¼ˆåªæä¾›ä¸€ä¸ªå‚æ•°ï¼‰
- [ ] å°æ™ºå›å¤ç®€çŸ­ï¼ˆ15å­—ä»¥å†…ï¼‰
- [ ] ç”¨æˆ·åªéœ€2æ¬¡ç¡®è®¤å³å¯å®Œæˆæµç¨‹

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
1. å®¹å™¨æ—¥å¿—ï¼š`sudo docker logs xiaozhi-esp32-server 2>&1 | tail -100`
2. é…ç½®æ–‡ä»¶ï¼š`cat data/.config.yaml | grep -A 20 "system_prompt"`
3. æµ‹è¯•å¯¹è¯è®°å½•

ç¥éƒ¨ç½²é¡ºåˆ©ï¼ğŸš€

