# ç¦»çº¿æ‰“åŒ…æ–¹æ¡ˆä¼˜åŒ–è¯´æ˜

## ğŸ“‹ ä¼˜åŒ–å†…å®¹æ€»ç»“

åŸºäºæ‚¨çš„åé¦ˆï¼Œæˆ‘å¯¹ç¦»çº¿æ‰“åŒ…æ–¹æ¡ˆè¿›è¡Œäº†ä»¥ä¸‹ä¸‰é¡¹é‡è¦ä¼˜åŒ–ï¼š

---

## 1. âœ… Sherpa ASRæ¨¡å‹å®Œæ•´æ‰“åŒ…æ”¯æŒ

### é—®é¢˜
è™½ç„¶æ‰“åŒ…è„šæœ¬ä¼šå¤åˆ¶æ•´ä¸ª`models`ç›®å½•ï¼Œä½†docker-composeé…ç½®ä¸­åªæŒ‚è½½äº†å•ä¸ªæ–‡ä»¶ï¼ˆ`SenseVoiceSmall/model.pt`ï¼‰ï¼Œå¯¼è‡´Sherpaæ¨¡å‹æ— æ³•è¢«å®¹å™¨è®¿é—®ã€‚

### è§£å†³æ–¹æ¡ˆ
**ä¿®æ”¹å‰**ï¼š
```yaml
volumes:
  # Model Files
  - ./models/SenseVoiceSmall/model.pt:/opt/xiaozhi-esp32-server/models/SenseVoiceSmall/model.pt
```

**ä¿®æ”¹å**ï¼š
```yaml
volumes:
  # Model Files - æŒ‚è½½æ•´ä¸ªmodelsç›®å½•ï¼Œæ”¯æŒæ‰€æœ‰æ¨¡å‹
  - ./models:/opt/xiaozhi-esp32-server/models
```

### ä¼˜åŠ¿
- âœ… **å®Œæ•´æ”¯æŒ**ï¼šè‡ªåŠ¨åŒ…å«æ‰€æœ‰æ¨¡å‹ç›®å½•ï¼ŒåŒ…æ‹¬ï¼š
  - `SenseVoiceSmall/` - FunASRè¯­éŸ³è¯†åˆ«æ¨¡å‹
  - `sherpa-onnx-sense-voice-zh-en-ja-ko-yue-2024-07-17/` - Sherpa ONNXæ¨¡å‹
  - `snakers4_silero-vad/` - VADè¯­éŸ³æ´»åŠ¨æ£€æµ‹æ¨¡å‹
- âœ… **çƒ­æ›´æ–°**ï¼šåœ¨å®¿ä¸»æœº`models`ç›®å½•æ·»åŠ æ–°æ¨¡å‹åï¼Œé‡å¯å®¹å™¨å³å¯ç”Ÿæ•ˆ
- âœ… **çµæ´»æ€§**ï¼šæ— éœ€ä¿®æ”¹docker-composeé…ç½®å³å¯æ·»åŠ æ–°æ¨¡å‹

### éªŒè¯æ–¹æ³•
éƒ¨ç½²åï¼Œåœ¨æœåŠ¡å™¨ä¸ŠéªŒè¯Sherpaæ¨¡å‹æ–‡ä»¶ï¼š
```bash
cd ~/xiaozhi-esp32-server/xiaozhi-offline-deployment-*/

# æ£€æŸ¥å®¿ä¸»æœºæ¨¡å‹æ–‡ä»¶
ls -lh models/sherpa-onnx-sense-voice-zh-en-ja-ko-yue-2024-07-17/

# æ£€æŸ¥å®¹å™¨å†…æ¨¡å‹æ–‡ä»¶
sudo docker exec xiaozhi-esp32-server ls -lh /opt/xiaozhi-esp32-server/models/sherpa-onnx-sense-voice-zh-en-ja-ko-yue-2024-07-17/

# æœŸæœ›è¾“å‡ºï¼š
# model.int8.onnx
# tokens.txt
```

---

## 2. âœ… ç§»é™¤èµ„æºé™åˆ¶ï¼Œè®©æœåŠ¡å……åˆ†è¿è¡Œ

### é—®é¢˜
æ‰€æœ‰æœåŠ¡ï¼ˆserverã€webã€dbã€redisï¼‰éƒ½é…ç½®äº†`deploy.resources`èµ„æºé™åˆ¶ï¼Œå¯èƒ½é™åˆ¶æœåŠ¡æ€§èƒ½è¡¨ç°ã€‚

### æ‚¨çš„è§‚ç‚¹æ­£ç¡®ï¼
**ç†ç”±**ï¼š
1. **é¦–æ¬¡éƒ¨ç½²åº”å…ˆè§‚å¯Ÿ**ï¼šåº”è¯¥è®©æœåŠ¡åœ¨å®é™…è´Ÿè½½ä¸‹å……åˆ†è¿è¡Œï¼Œæ”¶é›†èµ„æºå ç”¨æ•°æ®
2. **ç¡¬ä»¶å·®å¼‚**ï¼šä¸åŒæœåŠ¡å™¨çš„ç¡¬ä»¶é…ç½®å·®å¼‚å¾ˆå¤§ï¼Œç»Ÿä¸€é™åˆ¶ä¸åˆç†
3. **æ€§èƒ½ä¼˜å…ˆ**ï¼šAIæ¨ç†ã€è¯­éŸ³è¯†åˆ«ç­‰ä»»åŠ¡éœ€è¦å……è¶³èµ„æºï¼Œé™åˆ¶ä¼šå½±å“å“åº”é€Ÿåº¦
4. **åæœŸä¼˜åŒ–**ï¼šæœ‰äº†å®é™…æ•°æ®åï¼Œå†æ ¹æ®éœ€è¦è®¾ç½®åˆç†é™åˆ¶

### è§£å†³æ–¹æ¡ˆ
**ä¿®æ”¹å‰**ï¼ˆæ¯ä¸ªæœåŠ¡éƒ½æœ‰ç±»ä¼¼é…ç½®ï¼‰ï¼š
```yaml
xiaozhi-esp32-server:
  deploy:
    resources:
      limits:
        cpus: '4'
        memory: 8G
      reservations:
        cpus: '2'
        memory: 4G
```

**ä¿®æ”¹å**ï¼ˆæ‰€æœ‰æœåŠ¡çš„èµ„æºé™åˆ¶å·²æ³¨é‡Šï¼‰ï¼š
```yaml
xiaozhi-esp32-server:
  # deploy:  # ç§»é™¤èµ„æºé™åˆ¶ï¼Œè®©æœåŠ¡å……åˆ†è¿è¡Œä»¥è§‚å¯Ÿå®é™…èµ„æºå ç”¨
  #   resources:
  #     limits:
  #       cpus: '4'
  #       memory: 8G
  #     reservations:
  #       cpus: '2'
  #       memory: 4G
```

### ä¼˜åŠ¿
- âœ… **æ€§èƒ½æœ€å¤§åŒ–**ï¼šæœåŠ¡å¯ä»¥ä½¿ç”¨æ‰€æœ‰å¯ç”¨èµ„æºï¼Œå“åº”é€Ÿåº¦æ›´å¿«
- âœ… **çµæ´»æ€§**ï¼šé€‚é…ä¸åŒç¡¬ä»¶é…ç½®çš„æœåŠ¡å™¨
- âœ… **ä¾¿äºè§‚å¯Ÿ**ï¼šå¯ä»¥å‡†ç¡®æµ‹é‡å®é™…èµ„æºéœ€æ±‚
- âœ… **æ˜“äºè°ƒä¼˜**ï¼šåŸºäºçœŸå®æ•°æ®åæœŸå¯ä»¥æ·»åŠ åˆç†é™åˆ¶

### èµ„æºç›‘æ§å»ºè®®
éƒ¨ç½²åï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç›‘æ§å®é™…èµ„æºå ç”¨ï¼š

```bash
# å®æ—¶ç›‘æ§æ‰€æœ‰å®¹å™¨èµ„æº
sudo docker stats

# æŸ¥çœ‹ç‰¹å®šå®¹å™¨èµ„æº
sudo docker stats xiaozhi-esp32-server --no-stream

# è®°å½•24å°æ—¶èµ„æºæ•°æ®ï¼ˆå¯é€‰ï¼‰
while true; do 
  echo "$(date): $(sudo docker stats --no-stream --format 'table {{.Name}}\t{{.CPUPerc}}\t{{.MemUsage}}' | grep xiaozhi)" >> resource-monitor.log
  sleep 300  # æ¯5åˆ†é’Ÿè®°å½•ä¸€æ¬¡
done &
```

### ä½•æ—¶æ·»åŠ èµ„æºé™åˆ¶ï¼Ÿ
å»ºè®®åœ¨ä»¥ä¸‹æƒ…å†µä¸‹è€ƒè™‘æ·»åŠ é™åˆ¶ï¼š
1. **å¤šåº”ç”¨å…±å­˜**ï¼šæœåŠ¡å™¨ä¸Šè¿˜è¿è¡Œå…¶ä»–åº”ç”¨ï¼Œéœ€è¦é¿å…èµ„æºäº‰æŠ¢
2. **æˆæœ¬æ§åˆ¶**ï¼šäº‘æœåŠ¡å™¨æŒ‰èµ„æºè®¡è´¹ï¼Œéœ€è¦ç²¾ç¡®æ§åˆ¶æˆæœ¬
3. **ç¨³å®šæ€§ä¼˜å…ˆ**ï¼šé˜²æ­¢æŸä¸ªæœåŠ¡å ç”¨è¿‡å¤šèµ„æºå¯¼è‡´ç³»ç»Ÿä¸ç¨³å®š
4. **å·²æœ‰æ•°æ®**ï¼šå·²ç»æ”¶é›†äº†è¶³å¤Ÿçš„èµ„æºå ç”¨æ•°æ®ï¼Œå¯ä»¥è®¾ç½®åˆç†é˜ˆå€¼

---

## 3. ğŸ¤” MySQLç‰ˆæœ¬é—®é¢˜ - éœ€è¦æ‚¨å†³ç­–

### èƒŒæ™¯è¯´æ˜

#### æ‚¨é‡åˆ°çš„é—®é¢˜ï¼ˆåˆšæ‰ï¼‰
```
[ERROR] [MY-000067] [Server] unknown variable 'innodb_log_file_size=128M'.
xiaozhi-esp32-server-db exited with code 1
```

**åŸå› **ï¼šä½¿ç”¨`mysql:latest`æ‹‰å–åˆ°äº†MySQL 9.5.0ï¼Œè¯¥ç‰ˆæœ¬åºŸå¼ƒäº†`innodb_log_file_size`å‚æ•°ã€‚

#### ç‰ˆæœ¬å·®å¼‚è¯´æ˜

| æ ‡ç­¾ | å½“å‰æœ€æ–°ç‰ˆæœ¬ | ç¨³å®šæ€§ | å…¼å®¹æ€§ | è¯´æ˜ |
|------|------------|--------|--------|------|
| `mysql:latest` | 9.5.0 (2025å¹´10æœˆ) | âš ï¸ ä¸ç¨³å®š | âŒ ä¸å…¼å®¹ | åºŸå¼ƒäº†å¤šä¸ªé…ç½®å‚æ•° |
| `mysql:8.0` | 8.0.40 | âœ… ç¨³å®š | âœ… å®Œå…¨å…¼å®¹ | é•¿æœŸæ”¯æŒç‰ˆæœ¬ï¼ˆLTSï¼‰ |
| `mysql:8` | åŒ8.0.40 | âœ… ç¨³å®š | âœ… å®Œå…¨å…¼å®¹ | è‡ªåŠ¨è·Ÿéš8.xæœ€æ–°ç‰ˆ |
| `mysql:5.7` | 5.7.x | âš ï¸ EOL | âœ… å…¼å®¹ | å·²åœæ­¢æ”¯æŒ |

#### ä¸ºä»€ä¹ˆæœ¬åœ°å¯ä»¥ç”¨`latest`ï¼Ÿ

**å…³é”®ç‚¹**ï¼šæ‚¨æœ¬åœ°çš„`mysql:latest`å®é™…ä¸Šæ˜¯**ä¹‹å‰æ‹‰å–çš„æ—§ç‰ˆæœ¬**ã€‚

```bash
# æŸ¥çœ‹æ‚¨æœ¬åœ°å®é™…çš„MySQLç‰ˆæœ¬
docker images mysql

# å¯èƒ½çš„è¾“å‡ºï¼š
# mysql   latest   xxxxxx   3 months ago   ...
# è¿™ä¸ªé•œåƒå®é™…ä¸Šæ˜¯3ä¸ªæœˆå‰çš„MySQL 8.0.37ï¼Œè€Œä¸æ˜¯æœ€æ–°çš„9.5.0
```

**Dockeræ ‡ç­¾çš„ç‰¹æ€§**ï¼š
- `latest`æ ‡ç­¾ä¸æ˜¯å›ºå®šçš„ï¼Œå®ƒæ€»æ˜¯æŒ‡å‘**æœ€æ–°å‘å¸ƒçš„ç‰ˆæœ¬**
- å¦‚æœæ‚¨3ä¸ªæœˆå‰æ‹‰å–äº†`mysql:latest`ï¼Œé‚£æ—¶æ‹‰åˆ°çš„æ˜¯MySQL 8.0.37
- å¦‚æœæ‚¨ä»Šå¤©é‡æ–°æ‹‰å–`mysql:latest`ï¼Œä¼šæ‹‰åˆ°MySQL 9.5.0
- **ç¦»çº¿éƒ¨ç½²æ—¶**ï¼Œå¦‚æœæ‰“åŒ…æ—¶æ‹‰å–`latest`ï¼Œå¯èƒ½ä¼šæ‹‰åˆ°ä¸å…¼å®¹çš„æ–°ç‰ˆæœ¬

### ğŸ¯ æ¨èæ–¹æ¡ˆï¼ˆå·²é‡‡ç”¨ï¼‰

**ä½¿ç”¨ `mysql:8.0` æŒ‡å®šç‰ˆæœ¬**

#### ç†ç”±
1. âœ… **ç¨³å®šæ€§**ï¼šMySQL 8.0æ˜¯é•¿æœŸæ”¯æŒç‰ˆæœ¬ï¼ˆLTSï¼‰ï¼Œç»è¿‡å……åˆ†æµ‹è¯•
2. âœ… **å…¼å®¹æ€§**ï¼šå®Œå…¨å…¼å®¹é¡¹ç›®çš„æ‰€æœ‰é…ç½®å‚æ•°
3. âœ… **å¯é¢„æµ‹æ€§**ï¼šæ— è®ºä½•æ—¶ã€ä½•åœ°æ‹‰å–ï¼Œéƒ½æ˜¯8.0.xç‰ˆæœ¬
4. âœ… **å®˜æ–¹æ¨è**ï¼šMySQLå®˜æ–¹æ¨èç”Ÿäº§ç¯å¢ƒä½¿ç”¨8.0
5. âœ… **ä½œè€…åŸæ„**ï¼šé¡¹ç›®ä½œè€…ä½¿ç”¨çš„é…ç½®å‚æ•°åŸºäºMySQL 8.0è®¾è®¡

#### å½“å‰é…ç½®
```yaml
xiaozhi-esp32-server-db:
  image: mysql:8.0  # æŒ‡å®š8.0ç‰ˆæœ¬
```

---

### ğŸ”€ å¤‡é€‰æ–¹æ¡ˆï¼ˆå¦‚æœæ‚¨åšæŒç”¨latestï¼‰

å¦‚æœæ‚¨ç¡®å®å¸Œæœ›ä½¿ç”¨`mysql:latest`ï¼Œéœ€è¦é¢å¤–ä¿®æ”¹ï¼š

#### æ–¹æ¡ˆAï¼šä½¿ç”¨`mysql:latest`å¹¶æ¸…ç†é…ç½®

```yaml
xiaozhi-esp32-server-db:
  image: mysql:latest
  command:
    - --character-set-server=utf8mb4
    - --collation-server=utf8mb4_unicode_ci
    - --max_connections=1000
    # ç§»é™¤æ‰€æœ‰MySQL 8.0ç‰¹æœ‰çš„å‚æ•°
    # ä¸è¦æ·»åŠ  --innodb_buffer_pool_sizeï¼ˆ9.xå¯èƒ½ä¹Ÿä¼šåºŸå¼ƒï¼‰
```

**é£é™©**ï¼š
- âš ï¸ MySQL 9.xä»åœ¨å¿«é€Ÿè¿­ä»£ï¼Œæœªæ¥ç‰ˆæœ¬å¯èƒ½ç»§ç»­åºŸå¼ƒå‚æ•°
- âš ï¸ æ€§èƒ½è°ƒä¼˜å‚æ•°ç¼ºå¤±ï¼Œå¯èƒ½å½±å“é«˜å¹¶å‘åœºæ™¯
- âš ï¸ å‡çº§Dockeræ—¶å¯èƒ½æ‹‰åˆ°æ›´æ–°ç‰ˆæœ¬å¯¼è‡´ä¸å…¼å®¹

#### æ–¹æ¡ˆBï¼šä½¿ç”¨`mysql:8`ï¼ˆæŠ˜ä¸­æ–¹æ¡ˆï¼‰

```yaml
xiaozhi-esp32-server-db:
  image: mysql:8  # è‡ªåŠ¨è·Ÿéš8.xæœ€æ–°ç‰ˆæœ¬ï¼ˆå¦‚8.0.40 -> 8.0.41ï¼‰
```

**ä¼˜åŠ¿**ï¼š
- âœ… ä¿æŒåœ¨MySQL 8.xç‰ˆæœ¬èŒƒå›´å†…
- âœ… è‡ªåŠ¨è·å–8.xçš„å®‰å…¨è¡¥ä¸å’Œbugä¿®å¤
- âš ï¸ ä»å¯èƒ½åœ¨8.xå°ç‰ˆæœ¬å‡çº§æ—¶é‡åˆ°å…¼å®¹æ€§é—®é¢˜ï¼ˆæ¦‚ç‡è¾ƒä½ï¼‰

---

### ğŸ“Š ç‰ˆæœ¬é€‰æ‹©å¯¹æ¯”

| æ–¹æ¡ˆ | é•œåƒæ ‡ç­¾ | ç¨³å®šæ€§ | å…¼å®¹æ€§ | å¯é¢„æµ‹æ€§ | æ¨èåº¦ |
|------|---------|--------|--------|----------|--------|
| **æ¨è** | `mysql:8.0` | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ |
| æŠ˜ä¸­ | `mysql:8` | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­ |
| ä¸æ¨è | `mysql:latest` | â­â­ | â­â­ | â­ | â­ |

---

### ğŸ¬ å¦‚ä½•ä¿®æ”¹ç‰ˆæœ¬ï¼ˆå¦‚æœéœ€è¦ï¼‰

å¦‚æœæ‚¨å¸Œæœ›æ”¹ä¸ºå…¶ä»–ç‰ˆæœ¬ï¼Œä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶ï¼š

#### 1. ä¿®æ”¹docker-composeæ¨¡æ¿
```bash
# ç¼–è¾‘æ–‡ä»¶
vi scripts/docker-compose-offline.template.yml

# æ‰¾åˆ°ç¬¬100è¡Œå·¦å³ï¼Œä¿®æ”¹ï¼š
image: mysql:8.0     # æ”¹ä¸º mysql:latest æˆ– mysql:8
```

#### 2. ä¿®æ”¹æ‰“åŒ…è„šæœ¬
```powershell
# ç¼–è¾‘æ–‡ä»¶
notepad scripts\offline-package.ps1

# æ‰¾åˆ°ç¬¬132è¡Œå·¦å³ï¼Œä¿®æ”¹ï¼š
docker pull mysql:8.0     # æ”¹ä¸º mysql:latest æˆ– mysql:8

# æ‰¾åˆ°ç¬¬153è¡Œå·¦å³ï¼Œä¿®æ”¹ï¼š
docker save mysql:8.0     # æ”¹ä¸º mysql:latest æˆ– mysql:8
```

#### 3. é‡æ–°æ‰“åŒ…
```powershell
cd D:\workspace\xiaozhi-esp32-server
.\scripts\offline-package.ps1
```

---

## ğŸ¯ æˆ‘çš„å»ºè®®

### å½“å‰é…ç½®ï¼ˆæ¨èä¿æŒï¼‰

1. âœ… **æ¨¡å‹æŒ‚è½½**ï¼šæ•´ä¸ª`models`ç›®å½•ï¼Œæ”¯æŒSherpa ASR
2. âœ… **èµ„æºé™åˆ¶**ï¼šå·²å…¨éƒ¨ç§»é™¤ï¼Œè®©æœåŠ¡å……åˆ†è¿è¡Œ
3. âœ… **MySQLç‰ˆæœ¬**ï¼š`mysql:8.0`ï¼Œç¨³å®šä¸”å…¼å®¹

### ç†ç”±

**å…³äºMySQLç‰ˆæœ¬**ï¼š
- æ‚¨åˆšæ‰é‡åˆ°çš„é”™è¯¯å°±è¯æ˜äº†`latest`çš„ä¸å¯é¢„æµ‹æ€§
- ç¦»çº¿éƒ¨ç½²çš„æ ¸å¿ƒå°±æ˜¯**ç¯å¢ƒä¸€è‡´æ€§**å’Œ**å¯é¢„æµ‹æ€§**
- ä½¿ç”¨`mysql:8.0`å¯ä»¥ç¡®ä¿ä»»ä½•æ—¶å€™æ‰“åŒ…éƒ½å¾—åˆ°ç›¸åŒçš„ç»“æœ
- å¦‚æœæœªæ¥éœ€è¦å‡çº§åˆ°MySQL 9.xï¼Œå¯ä»¥ç­‰å…¶ç¨³å®šåå†ç»Ÿä¸€å‡çº§

**å¦‚æœæ‚¨ä»å¸Œæœ›ä½¿ç”¨`latest`**ï¼š
- æˆ‘å»ºè®®è‡³å°‘ä½¿ç”¨`mysql:8`ä½œä¸ºæŠ˜ä¸­
- è¿™æ ·å¯ä»¥è·å¾—8.xçš„æ›´æ–°ï¼Œåˆä¸ä¼šè·³åˆ°ä¸å…¼å®¹çš„9.x

---

## ğŸ“¦ éªŒè¯ä¼˜åŒ–æ•ˆæœ

é‡æ–°æ‰“åŒ…å¹¶éƒ¨ç½²åï¼ŒéªŒè¯ä¼˜åŒ–æ•ˆæœï¼š

### 1. éªŒè¯Sherpaæ¨¡å‹
```bash
# åœ¨æœåŠ¡å™¨ä¸Š
cd ~/xiaozhi-esp32-server/xiaozhi-offline-deployment-*/

# æ£€æŸ¥æ¨¡å‹æ–‡ä»¶
ls -lh models/sherpa-onnx-sense-voice-zh-en-ja-ko-yue-2024-07-17/

# æ£€æŸ¥å®¹å™¨å†…æ¨¡å‹
sudo docker exec xiaozhi-esp32-server ls -lh /opt/xiaozhi-esp32-server/models/sherpa-onnx-sense-voice-zh-en-ja-ko-yue-2024-07-17/

# æµ‹è¯•Sherpa ASRï¼ˆéœ€è¦é…ç½®data/.config.yamlä½¿ç”¨Sherpaï¼‰
# ç¡®è®¤æ™ºæ§å°çš„ASRé…ç½®é€‰æ‹©äº†SherpaASR
```

### 2. éªŒè¯èµ„æºä½¿ç”¨
```bash
# å®æ—¶ç›‘æ§èµ„æº
sudo docker stats

# æ£€æŸ¥æ˜¯å¦æœ‰èµ„æºé™åˆ¶ï¼ˆåº”è¯¥æ˜¾ç¤ºä¸ºä¸é™åˆ¶ï¼‰
sudo docker inspect xiaozhi-esp32-server | grep -A 20 "Resources"
# åº”è¯¥çœ‹åˆ°æ‰€æœ‰é™åˆ¶ä¸º0ï¼ˆè¡¨ç¤ºä¸é™åˆ¶ï¼‰
```

### 3. éªŒè¯MySQLç‰ˆæœ¬
```bash
# æ£€æŸ¥MySQLé•œåƒç‰ˆæœ¬
sudo docker images | grep mysql

# æ£€æŸ¥MySQLè¿è¡Œç‰ˆæœ¬
sudo docker exec xiaozhi-esp32-server-db mysql -V

# æœŸæœ›è¾“å‡ºï¼šmysql  Ver 8.0.x for Linux...
```

---

## ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ

### 1. ç¡®è®¤é…ç½®ï¼ˆå¯é€‰ï¼‰
å¦‚æœæ‚¨å¸Œæœ›ä¿®æ”¹MySQLç‰ˆæœ¬ï¼Œè¯·æŒ‰ç…§ä¸Šé¢"å¦‚ä½•ä¿®æ”¹ç‰ˆæœ¬"éƒ¨åˆ†æ“ä½œã€‚

### 2. é‡æ–°æ‰“åŒ…ï¼ˆåœ¨Windowsä¸Šï¼‰
```powershell
cd D:\workspace\xiaozhi-esp32-server

# è¿è¡Œä¼˜åŒ–åçš„æ‰“åŒ…è„šæœ¬
.\scripts\offline-package.ps1

# ç­‰å¾…æ‰“åŒ…å®Œæˆï¼ˆçº¦10-30åˆ†é’Ÿï¼‰
# ç”Ÿæˆï¼šxiaozhi-offline-deployment-YYYYMMDD-HHMMSS.tar.gz
```

### 3. ä¼ è¾“åˆ°æœåŠ¡å™¨
```powershell
scp xiaozhi-offline-deployment-*.tar.gz root@æœåŠ¡å™¨IP:/root/
```

### 4. éƒ¨ç½²ï¼ˆåœ¨æœåŠ¡å™¨ä¸Šï¼‰
```bash
# å¤‡ä»½æ—§éƒ¨ç½²ï¼ˆå¦‚æœéœ€è¦ï¼‰
cd ~/xiaozhi-esp32-server
mv xiaozhi-offline-deployment-* xiaozhi-offline-deployment-old-$(date +%Y%m%d)

# è§£å‹æ–°åŒ…
tar -xzf /root/xiaozhi-offline-deployment-*.tar.gz
cd xiaozhi-offline-deployment-*/

# å¦‚æœæ˜¯é¦–æ¬¡éƒ¨ç½²
chmod +x offline-deploy.sh install-docker-centos.sh
sudo ./offline-deploy.sh

# å¦‚æœæ˜¯æ›´æ–°éƒ¨ç½²
sudo docker-compose -f docker-compose-offline.yml down
cd ../xiaozhi-offline-deployment-æ–°ç›®å½•/images
sudo docker load -i server.tar
sudo docker load -i web.tar
sudo docker load -i mysql.tar
cd ..
sudo docker-compose -f docker-compose-offline.yml up -d
```

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœæ‚¨ï¼š
1. **æƒ³ä¿®æ”¹MySQLç‰ˆæœ¬**ï¼šè¯·å‘Šè¯‰æˆ‘æ‚¨å¸Œæœ›ä½¿ç”¨å“ªä¸ªç‰ˆæœ¬ï¼ˆlatestã€8ã€8.0ï¼‰
2. **é‡åˆ°éƒ¨ç½²é—®é¢˜**ï¼šæä¾›é”™è¯¯æ—¥å¿—å’Œå®¹å™¨çŠ¶æ€
3. **éœ€è¦æ€§èƒ½è°ƒä¼˜**ï¼šåˆ†äº«èµ„æºç›‘æ§æ•°æ®ï¼Œæˆ‘å¯ä»¥å¸®æ‚¨è®¾ç½®åˆç†é™åˆ¶

---

## âœ… ä¼˜åŒ–æ€»ç»“

| ä¼˜åŒ–é¡¹ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ•ˆæœ |
|--------|--------|--------|------|
| **æ¨¡å‹æ”¯æŒ** | åªæ”¯æŒå•ä¸ªæ¨¡å‹æ–‡ä»¶ | æ”¯æŒæ‰€æœ‰æ¨¡å‹ç›®å½• | âœ… Sherpa ASRå¯ç”¨ |
| **èµ„æºé™åˆ¶** | ä¸¥æ ¼é™åˆ¶CPU/å†…å­˜ | æ— é™åˆ¶ | âœ… æ€§èƒ½æœ€å¤§åŒ– |
| **MySQLç‰ˆæœ¬** | mysql:latest (9.5.0ä¸å…¼å®¹) | mysql:8.0 (ç¨³å®šå…¼å®¹) | âœ… å¯é¢„æµ‹ã€ç¨³å®š |

æ‰€æœ‰ä¼˜åŒ–å·²å®Œæˆï¼Œæ‚¨å¯ä»¥æ”¾å¿ƒé‡æ–°æ‰“åŒ…éƒ¨ç½²äº†ï¼ğŸš€

